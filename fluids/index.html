<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="/img/favicon.ico">
        <meta name="keywords" content="Finite Element Library,Finite Element Code,Finite Element Method Library,Finite Element Method Code,Finite Element C++,Finite Element Method C++,Finite Element Library C++,Finite Element Code C++,FEM Code,FEM Library,FEM C++">
        <meta name="google-site-verification" content="45K56TawSdzbgy-uDtfJdYwp7zaVdL3fIAGYt869wwU" />
<!--	<title></title>  -->
        <title>MFEM - Finite Element Discretization Library</title>

        <link href="../css/bootstrap-mfem.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/highlight.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="http://mfem.org">MFEM</a>
        </div>

        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
            
            
            
                <li >
                    <!-- Replace "nav_item.url|url" with "nav_item.url" for older mkdocs (before 1.0) -->
                    <a href="../features/">Features</a>
                </li>
            
            
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
                            <li >
                                 <a href="../examples/">Example Codes</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../electromagnetics/">Electromagnetics</a>
                            </li>
                        
                    
                        
                            <li class="active">
                                 <a href="./">Fluid Dynamics</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../meshing-miniapps/">Meshing</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../autodiff/">Automatic Differentiation</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../tools/">Tools</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../toys/">Toys</a>
                            </li>
                        
                    
                    </ul>
                </li>
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
                    
                        
                            <li >
                                 <a href="../getting-started/">Getting Started</a>
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            <li >
                                 <a href="../howto/howto-index/">HowTo Articles</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../fem/">Finite Elements</a>
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            <li >
                                 <a href="../performance/">Performance</a>
                            </li>
                        
                    
                        
                    
                        
                            <li >
                                 <a href="../gpu-support/">GPU Support</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../mesh-formats/">Mesh Formats</a>
                            </li>
                        
                    
                        
                    
                        
                    
                        
                            <li >
                                 <a href="../dox/">Doxygen</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../publications/">Publications</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../about/">About</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="../search/">ðŸ”Ž Search...</a>
                            </li>
                        
                    
                    </ul>
                </li>
            
            
            
            
            
                <li >
                    <!-- Replace "nav_item.url|url" with "nav_item.url" for older mkdocs (before 1.0) -->
                    <a href="../gallery/">Gallery</a>
                </li>
            
            
            
            
            
                <li >
                    <!-- Replace "nav_item.url|url" with "nav_item.url" for older mkdocs (before 1.0) -->
                    <a href="../download/">Download</a>
                </li>
            
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li>
                    <a href="https://github.com/mfem/mfem/">
                        
                            <i class="fa fa-github-square"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        
        <div class="container">
            
            <div class="col-md-3 visible-xs visible-sm"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#navier-stokes-mini-application">Navier-Stokes Mini Application</a></li>
        
            <li><a href="#theory">Theory</a></li>
        
            <li><a href="#boundary-conditions">Boundary Conditions</a></li>
        
            <li><a href="#solvers-and-preconditioners">Solvers and preconditioners</a></li>
        
            <li><a href="#faq">FAQ</a></li>
        
    
    
	
	
           <hr style="background-color:white; height:20px; margin-left:-1px;  margin-right:-1px; margin-top:15px; margin-bottom:10px " />
           <li><a href="../getting-started/"><i class="fa fa-chevron-circle-left"></i> Back to Getting Started</a> </li>
        
	
	
    
    </ul>
</div>

<!-- Developer notes:
  See the MkDocs documentation in https://www.mkdocs.org/dev-guide/themes/#page
  and the Jinja2 template API in https://tedboy.github.io/jinja2/index.html
--></div> <!-- toc on top on mobile -->
            <div class="col-md-9" role="main">

<h1 id="navier-stokes-mini-application">Navier-Stokes Mini Application</h1>
<p>The solver implemented in this miniapp solves the transient incompressible
Navier-Stokes equations.</p>
<h2 id="theory">Theory</h2>
<p>The equations are given in the non-dimensionalized form</p>
<p>\begin{align}
    \frac{\partial u}{\partial t} + (u \cdot \nabla) u - \frac{1}{Re} \nabla^2 u + \nabla p &amp;= f &amp; \quad \text{in } \Omega\\
    \nabla \cdot u &amp;= 0 &amp; \quad \text{in } \Omega
\end{align}</p>
<p>where $Re$ represents the Reynolds number. In order to solve these equations,
the method presented in Tomboulides (1997)<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup> is used, which is based on an
equal order finite element discretization on quadrilateral or hexahedral
elements of high polynomial order. The method describes an implicit-explicit
time-integration scheme for the viscous and convective terms respectively.
Introducing the following notation the nonlinear term $N(u) = -(u \cdot \nabla)
u$ and the time-extrapolated form</p>
<p>\begin{align}
    \label{eq:Next}
    N^*(u^{n+1}) = \sum_{j=1}^k a_j N(u^{n+1-j})
\end{align}</p>
<p>where $a_j$ are coefficients from the corresponding explicit time integration
method.</p>
<p>Applying a BDF method with coefficients $b_j$ to the initial equation using the
introduced forms yields</p>
<p>\begin{align}
    \sum_{j=0}^k \frac{b_j}{\Delta t} u^{n+1-j} =
    -\nabla p^{n+1} + L(u^{n+1}) + N^*(u^{n+1}) + f^{n+1}.
\end{align}</p>
<p>Collecting all known quantities at a given time with</p>
<p>\begin{align}
    F^*(u^{n+1}) = -\sum_{j=1}^k \frac{b_j}{\Delta t} u^{n+1-j}
    + N^*(u^{n+1}) + f^{n+1}
\end{align}</p>
<p>the BDF expression reduces to</p>
<p>\begin{align}
    \label{eq:bdf_short}
    \frac{b_0}{\Delta t} u^{n+1} = -\nabla p^{n+1} + L(u^{n+1}) + F^*(u^{n+1}).
\end{align}</p>
<p>To achieve a high order convergence in space, the linear term $L(u)$ is replaced
by</p>
<p>\begin{align}
    L_{\times}(u) = \nu \nabla(\nabla \cdot u) - \nu \nabla \times \nabla \times u
\end{align}</p>
<p>which is used to weakly enforce incompressibility by setting the first term to
zero. Like in \eqref{eq:Next} we introduce the time extrapolated term</p>
<p>\begin{align}
    L^*_{\times}(u^{n+1}) = \sum_{j=1}^k a_j L_{\times}(u^{n+1-j}).
\end{align}</p>
<p>To compute the pressure we rearrange \eqref{eq:bdf_short} and take the
divergence on both sides</p>
<p>\begin{align}
    \label{eq:prespois}
    \nabla^2 p^{n+1} = \nabla \cdot (L_{\times}^*(u^{n+1}) + F^*(u^{n+1})),
\end{align}</p>
<p>which is closed by the Neumann type boundary condition</p>
<p>\begin{align}
    \nabla p^{n+1} \cdot \hat{n} = -\frac{b_0}{\Delta t} u^{n+1} \cdot \hat{n}
    + (L_{\times}^*(u^{n+1}) + F^*(u^{n+1})) \cdot \hat{n}.
\end{align}</p>
<p>We will refer to this as the pressure Poisson equation in the following. The
last step is a Helmholtz type equation to solve for the implicit (viscous)
velocity part which is also derived from \eqref{eq:bdf_short}. Consider</p>
<p>\begin{align}
    \label{eq:hlm}
    \frac{b_0}{\Delta t} u^{n+1} - L(u^{n+1}) = -\nabla p^{n+1} + F^*(u^{n+1})
\end{align}</p>
<p>with the Dirichlet (essential type) boundary condition</p>
<p>\begin{align}
    u^{n+1} = g_D^{n+1}.
\end{align}</p>
<p>A detailed walk through can also be found in Franco et al (2020) <sup id="fnref:2"><a class="footnote-ref" href="#fn:2" rel="footnote">2</a></sup>.</p>
<p><strong>Note</strong> <em>The notation is very similar to what is used in the code to make it easy
to follow the theoretical explanation and understand what is done in the
implementation.</em></p>
<h2 id="boundary-conditions">Boundary Conditions</h2>
<h3 id="inflow-and-no-slip-walls">Inflow and no-slip walls</h3>
<p>For inflow or no-slip wall boundary conditions one should use the method
<em>NavierSolver::AddVelDirichletBC</em>. This enforces the value on $u^{n+1}$ in
\eqref{eq:hlm}. It is valid to call this method multiple times on different
boundary attributes of the mesh. The <em>NavierSolver</em> instance keeps track of the
associated <em>Coefficient</em> and accompanying boundary attribute. The passed
attribute array can be modified, deleted or reused, since a copy is created.</p>
<h3 id="pressure-outlet">Pressure outlet</h3>
<p>If an outlet of a domain is supposed to represent a pressure outlet (e.g.
zero-pressure), one should use the method <em>NavierSolver::AddPresDirichletBC</em>.
This enforces the pressure value $p^{n+1}$ in \eqref{eq:prespois}.</p>
<h3 id="zero-stress">Zero-stress</h3>
<p>This boundary condition is used to represent an outflow attribute. Due to the
nature of the $H^1$ finite-element discretization, the terms arise naturally in
\eqref{eq:prespois} and \eqref{eq:hlm} resulting in</p>
<p>\begin{align}
    \nu \nabla u \cdot \hat{n} - p \mathbb{I} \cdot \hat{n} = 0,
\end{align}</p>
<p>where $\mathbb{I}$ represents the identity tensor.</p>
<p>If there is no other boundary condition applied to a certain attribute, this
boundary condition is applied automatically (not through modification but rather
through the formulation).</p>
<h2 id="solvers-and-preconditioners">Solvers and preconditioners</h2>
<p>The choice of solvers and preconditioners for \eqref{eq:prespois} and
\eqref{eq:hlm} are essential for the performance and robustness of the
simulation.</p>
<p>The pressure Poisson equation \eqref{eq:prespois} is solved using the CG Krylov
method in combination with the low-order refined preconditioning technique
coupled with AMG (c.f. Franco et al (2020)<sup id="fnref2:2"><a class="footnote-ref" href="#fn:2" rel="footnote">2</a></sup>).</p>
<p>Due to the nature of the explicit time discretization of the nonlinear term, the
method used is CFL (and therefore time step) bound. As a result the time
derivative term in \eqref{eq:hlm} is dominating and a CG Krylov method
preconditioned with Jacobi is sufficient.</p>
<p>Depending on the problem, this results in the majority of time per time step
being spent in the pressure Poisson solve.</p>
<p>At the moment there is no interface to change the default options for the
solvers, but a user can easily modify them in the code itself.</p>
<h2 id="faq">FAQ</h2>
<ul>
<li>
<p><strong>You are using the spectral element method, why is the mass matrix not a
vector representing the condensed diagonal?</strong> This is a design choice. It is
possible to use the "numerical integration" option, which produces a diagonal
mass matrix with 1 non zero value per row. This leaves freedom to experiment.</p>
</li>
<li>
<p><strong>Do you support simulations using real parameters?</strong> No, right now you have
 to non-dimensionalize your problem. Not doing this impacts the performance a
 lot.</p>
</li>
<li>
<p><strong>I want to implement turbulence model X, how do I dot that?</strong> This is another
 design choice to make and should be discussed, preferably in a Github issue.</p>
</li>
<li>
<p><strong>Why doesn't it have adaptive time stepping?</strong> While it is possible and there
exists a branch that works with varying step sizes (variable order/variable step
size IMEX), I have not found a reliable and robust method to determine the step
size (CFL based error estimators are very squishy here or have to use a very
conservative limit).</p>
</li>
<li>
<p><strong>How do I compute steady state solutions with this?</strong> There is no
 acceleration to steady state algorithm implemented right now. Your only option
 is to run the transient case until you reach a steady state criterion. (See
 adaptive time stepping FAQ above).</p>
</li>
</ul>
<script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: {equationNumbers: {autoNumber: "all"}}, tex2jax: {inlineMath: [['$','$']]}});</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML"></script>

<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>A. G. Tomboulides, J. C. Y. Lee &amp; S. A. Orszag (1997) Numerical Simulation
of Low Mach Number Reactive Flows&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Michael Franco, Jean-Sylvain Camier, Julian Andrej, Will Pazner (2020)
High-order matrix-free incompressible flow solvers with GPU acceleration and
low-order refined preconditioners (https://arxiv.org/abs/1910.03032)&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
            <div class="col-md-3 hidden-xs hidden-sm"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#navier-stokes-mini-application">Navier-Stokes Mini Application</a></li>
        
            <li><a href="#theory">Theory</a></li>
        
            <li><a href="#boundary-conditions">Boundary Conditions</a></li>
        
            <li><a href="#solvers-and-preconditioners">Solvers and preconditioners</a></li>
        
            <li><a href="#faq">FAQ</a></li>
        
    
    
	
	
           <hr style="background-color:white; height:20px; margin-left:-1px;  margin-right:-1px; margin-top:15px; margin-bottom:10px " />
           <li><a href="../getting-started/"><i class="fa fa-chevron-circle-left"></i> Back to Getting Started</a> </li>
        
	
	
    
    </ul>
</div>

<!-- Developer notes:
  See the MkDocs documentation in https://www.mkdocs.org/dev-guide/themes/#page
  and the Jinja2 template API in https://tedboy.github.io/jinja2/index.html
--></div>
            
        </div>
        

        <footer class="footer">
           <div class="container">
              <p class="text-muted alignright">LLNL-WEB-676715</p>
              <p class="text-muted alignleft">
                  Developed by the <a href="/about/">MFEM team</a> at
                  <a href="http://computation.llnl.gov/casc/">CASC</a>,
                  <a href="https://www.llnl.gov/">LLNL</a></p>
           </div>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
        <script src="../js/retina.min.js"></script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../search/main.js"></script>
    </body>
</html>